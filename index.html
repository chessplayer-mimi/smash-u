<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>你破防了嗎</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin: auto;
    }
    .question {
      font-size: 20px;
      margin-bottom: 20px;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .btn {
      padding: 10px 20px;
      font-size: 18px;
      margin: 10px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
    }
    .btn-yes {
      background-color: red;
      color: white;
    }
    .btn-no {
      background-color: green;
      color: white;
    }
    .vote-count {
      font-size: 16px;
      margin-top: 10px;
    }
    .comments {
      margin-top: 20px;
      text-align: left;
    }
    .comment {
      background: #eee;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
    }
    input {
      width: calc(100% - 22px);
      padding: 8px;
      margin-top: 10px;
    }
    button {
      margin-top: 5px;
    }
  </style>
  <!-- Firebase SDK (v8 使用方式) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    // 請將下面的 firebaseConfig 替換成你自己的設定
    var firebaseConfig = {
      apiKey: "AIzaSyApYELKuOXZuziXfioTe0fxWfw2FWTHCR0",
  authDomain: "smash-u.firebaseapp.com",
  databaseURL: "https://smash-u-default-rtdb.firebaseio.com",
  projectId: "smash-u",
  storageBucket: "smash-u.firebasestorage.app",
  messagingSenderId: "127249508129",
  appId: "1:127249508129:web:f064c108daa2b76223c060",
    };
    // 初始化 Firebase
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();
  </script>
</head>
<body>
  <div class="container">
    <div class="question" id="question">載入中...</div>
    <button class="btn btn-yes" onclick="handleYes()">是</button>
    <button class="btn btn-no" onclick="handleNo()">否</button>
    <p class="vote-count">按「是」的人數: <span id="yesCount">0</span></p>

    <div class="comments">
      <h3>留言區</h3>
      <div id="commentList"></div>
      <input type="text" id="commentInput" placeholder="輸入留言...">
      <button onclick="addComment()">送出</button>
    </div>

    <p>破防次數: <span id="score">0</span></p>
  </div>

  <script>
    const questions = [
      "我完全沒讀但考一百耶。",
      "我玩了一整個學期結果校排第一耶。",
  "你讀了一整個學期？我的分數是你的兩倍欸。",
  "昨天晚上打了一整晚遊戲，今天考試滿分，哈哈。",
  "我上課都在睡覺，結果學測考上台清交。",
  "作業隨便寫寫，老師還拿我的當模範答案。",
  "你補習補那麼多？我沒補結果贏你一百分欸。",
  "考前才讀一天，結果比你認真準備半年還高分。",
  "你拼了命考 90 分，我放水考 99 分。",
  "啊？你在準備研究所？我隨便考考就上國外名校了。",
  "你說這次考試很難？我寫完還剩半小時欸！？",
  "我沒讀，結果老師還誇我答題方式超棒！",
  "考試都考課本內容，你怎麼還會錯？",
  "考前老師說的重點，我剛好都有背到耶！",
  "這次考試我只讀了一個晚上，結果還是考滿分。",
  "我連筆記都沒寫過，結果成績最好！",
  "我沒帶計算機，結果手算剛好全對。",
  "你還在寫？我考完還有時間滑手機。",
  "這次考試是開書考，但其實根本不用翻書。",
  "這考試好簡單，難道只有我覺得這樣嗎？",
  "不小心寫錯一題，不然就滿分了。",
  "老師出的題目我之前在某本書上看過，剛好有印象。",
  "這次考試其實不用準備吧？",
  "考試的時候我隨手一猜，結果剛好猜對了。",
  "考前還在看漫畫，結果考超好！",
  "你有聽老師講課嗎？我沒聽也都會寫。",
  "老師講課好慢，我都已經在寫下一章了。",
  "你還在補習？我沒補也可以考這麼高。",
  "補習班老師教的跟學校一模一樣，沒什麼好補的吧？",
  "這作業不用寫也沒差，老師不會改。",
  "你比我努力這麼多，結果成績還沒我高？",
  "你有參加這次競賽？不好意思，我拿冠軍了。",
  "你學這麼久？我一週內就會了。",
  "你的 GPA 3.8？我的 4.3 耶。",
  "學校辦活動？我不去，結果老師直接送我 10 分加分。",
  "這篇論文老師幫我發到期刊了，你的呢？",
  "你報告寫 10 頁？我 1 頁就拿滿分了。",
  "學長姐的作品好厲害？可是我覺得還好耶。",
  "這場演講？老師叫我臨時上去，結果還拿第一。",
  "這麼簡單的作業，還需要討論？",
  "你還在寫暑假作業？我兩天內就寫完了。",
  "我們這組分工？不用，我一個人做比較快。",
  "這麼拼命讀書？結果還是輸我。",
  "你的專題？我幾天內就寫出來了。",
  "這堂課老師給的分數都是 100，不用擔心啦！",
  "這門課不用來上課也可以 A+ 吧？",
  "你這週考試很忙？我週末出去玩還是考最高。"
    ];

    let currentQuestionIndex = 0;
    let score = 0;

    // 監聽目前題目的票數變化
    function listenVotes() {
      firebase.database().ref('votes/' + currentQuestionIndex).on('value', function(snapshot) {
        var count = snapshot.val() || 0;
        document.getElementById("yesCount").innerText = count;
      });
    }

    // 監聽目前題目的留言變化
    function listenComments() {
      firebase.database().ref('comments/' + currentQuestionIndex).on('value', function(snapshot) {
        const commentList = document.getElementById("commentList");
        commentList.innerHTML = "";
        snapshot.forEach(function(childSnapshot) {
          let comment = childSnapshot.val();
          let commentDiv = document.createElement("div");
          commentDiv.className = "comment";
          commentDiv.innerText = comment;
          commentList.appendChild(commentDiv);
        });
      });
    }

    function loadQuestion() {
      document.getElementById("question").innerText = questions[currentQuestionIndex];
      // 取消之前題目的監聽（避免監聽重複觸發）
      firebase.database().ref('votes/' + currentQuestionIndex).off();
      firebase.database().ref('comments/' + currentQuestionIndex).off();
      // 開始監聽新的題目
      listenVotes();
      listenComments();
    }

    function handleYes() {
      score++;
      document.getElementById("score").innerText = score;

      // 使用 transaction 來確保數據同步遞增
      var voteRef = firebase.database().ref('votes/' + currentQuestionIndex);
      voteRef.transaction(function(currentCount) {
        return (currentCount || 0) + 1;
      });

      nextQuestion();
    }

    function handleNo() {
      nextQuestion();
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex >= questions.length) {
        alert("遊戲結束！你的破防次數: " + score);
        currentQuestionIndex = 0;
        score = 0;
        document.getElementById("score").innerText = score;
      }
      loadQuestion();
    }

    function addComment() {
      let commentInput = document.getElementById("commentInput");
      let commentText = commentInput.value.trim();
      if (commentText === "") return;

      // 將留言 push 到 Firebase
      firebase.database().ref('comments/' + currentQuestionIndex).push(commentText);
      commentInput.value = "";
    }

    window.onload = function() {
      loadQuestion();
    };
  </script>
</body>
</html>
